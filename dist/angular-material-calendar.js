angular.module("materialCalendar",["ngMaterial","ngSanitize"]).filter("dateToGmt",function(){return function(a){return a=a||new Date,new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()))}}).service("Calendar",["$filter",function(a){function e(e,t){var n=a("dateToGmt")();this.year=n.getFullYear(),this.month=n.getMonth(),this.dates=[],this.getNumDays=function(){return a("dateToGmt")(new Date(this.start.getYear(),this.start.getMonth()+1,0)).getDate()},this.firstDayOfWeek="Sunday",this.getFirstDayOfCalendar=function(){var a=this.start,e=new Date(a.getFullYear(),a.getMonth(),1);return e.setDate(e.getDate()-e.getDay()+("Sunday"===this.firstDayOfWeek?0:1)),e},this.next=function(){this.init(this.year,this.month+2)},this.prev=function(){this.init(this.year,this.month)},this._isFirstDayOfWeek=function(a){return!a.getDay()},this.init=function(e,t){e&&t?(this.year=e,this.month=t-1):e&&!t&&(this.year=e-1,this.month=11),this.start=a("dateToGmt")(new Date(this.year,this.month,1,0,0)),this.dates=[],this.weeks=[],this.year=this.start.getFullYear(),this.month=this.start.getMonth();for(var n=this.getFirstDayOfCalendar(),d=1==n.getDate()&&28==this.getNumDays()?28:35,r=0;d>r;r++){var l=a("dateToGmt")(new Date(n.valueOf()+864e5*r));r%7===0&&this.weeks.push([]),this.dates.push(l),this.weeks[this.weeks.length-1].push(l)}return this.dates},this.init(e,t)}return e}]).directive("mdCalendar",["$compile","$parse","$http","$q","$filter","Calendar",function(a,e,t,n,d,r){var l,o="<md-content class='md-calendar' layout='column' layout-fill flex md-swipe-left='next()' md-swipe-right='prev()'><md-toolbar><div class='md-toolbar-tools' layout='row'><md-button class='md-calendar-left-btn' ng-click='prev()'>&laquo;</md-button><h2 class='md-calendar-title' flex><span>{{ calendar.start | date:titleFormat:timezone }}</span></h2><md-button class='md-calendar-left-btn' ng-click='next()'>&raquo;</md-button></div></md-toolbar><md-content flex layout='column' layout-fill><div class='md-calendar-subheader' layout='row' layout-fill layout-padding layout-align='space-between center' ng-hide='weekLayout == &quot;column&quot;'><div class='md-calendar-subheader-day' flex ng-repeat='day in calendar.weeks[0]'><md-tooltip>{{ day | date:dayLabelTooltipFormat:timezone }}</md-tooltip>{{ day | date:dayLabelFormat:timezone }}</div></div><div flex class='md-calendar-month' layout='column'><div flex class='md-calendar-week' ng-class='calendarDirection' layout='{{ weekLayout }}' layout-fill ng-repeat='week in calendar.weeks'><div class='md-calendar-day' ng-hide='! sameMonth(day) && weekLayout == columnWeekLayout' ng-class='{&quot;md-calendar-day-inactive&quot; : ! sameMonth(day), active: active === day }' flex layout layout-fill ng-click='handleDayClick(day)' ng-repeat='day in week' ng-class='{ active: active === day }'><md-tooltip>{{ day | date:dayTooltipFormat:timezone }}</md-tooltip><div class='md-calendar-number'>{{ day | date:dayFormat:timezone }}</div><div class='md-calendar-content' flex ng-bind-html='getDayContent(day)'></div></div></div></div></md-content></md-content>",i=function(){if(!l){var a=document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css",e.id="mdCalendarCss",e.innerHTML="md-calendar .md-calendar-subheader,md-calendar .md-calendar-week.horizontal .md-calendar-day:first-child,md-calendar .md-calendar-week.vertical,md-calendar .md-subheader{border-left:1px solid rgba(0,0,0,.12)}md-calendar{display:block;max-height:100%}md-calendar .md-calendar-subheader{min-height:36px;border-right:1px solid rgba(0,0,0,.12)}md-calendar .md-calendar-day{border-bottom:1px solid rgba(0,0,0,.12);border-right:1px solid rgba(0,0,0,.12);padding:6px;min-height:48px;box-sizing:border-box}md-calendar .md-calendar-day,md-calendar .md-calendar-subheader-day{overflow-x:hidden;text-overflow:ellipsis}md-calendar .md-calendar-month:first-child .md-calendar-day,md-calendar .md-calendar-week:first-child{border-top:1px solid rgba(0,0,0,.12)}md-calendar .md-calendar-day:not(.md-calendar-day-inactive){cursor:pointer}md-calendar .md-calendar-day-inactive{color:rgba(0,0,0,.3);pointer-events:none}md-calendar .md-calendar-day-inactive .md-calendar-number{color:inherit}md-calendar .md-subheader{border-right:1px solid rgba(0,0,0,.12);margin-right:0}md-calendar .md-calendar-day.active{background-color:rgba(0,0,0,.06)}md-calendar .md-subheader:not(.md-sticky-no-effect):after{right:0!important}md-calendar .md-calendar-day:hover{background:rgba(0,0,0,.04)}md-calendar .md-calendar-number{padding:0}",a.insertBefore(e,a.firstChild),l=!0}};return{restrict:"E",scope:{ngModel:"=?",template:"&",templateUrl:"=?",onDayClick:"=?",onPrevMonth:"=?",onNextMonth:"=?",calendarDirection:"=?",dayContent:"=?",timezone:"=?",titleFormat:"=?",dayFormat:"=?",dayLabelFormat:"=?",dayLabelTooltipFormat:"=?",dayTooltipFormat:"=?"},link:function(l,c,m,s){i(),l.columnWeekLayout="column",l.weekLayout="row",l.timezone=l.timezone||null,l.titleFormat=l.titleFormat||"MMMM yyyy",l.dayLabelFormat=l.dayLabelFormat||"EEE",l.dayLabelTooltipFormat=l.dayLabelTooltipFormat||"EEEE",l.dayFormat=l.dayFormat||"d",l.dayTooltipFormat=l.dayTooltipFormat||"fullDate",l.getDayContent=l.dayContent||function(){},l.sameMonth=function(a){var e=d("dateToGmt")(a);return e.getFullYear()===l.calendar.year&&e.getMonth()===l.calendar.month},l.calendarDirection=l.calendarDirection||"horizontal",l.$watch("calendarDirection",function(a){l.weekLayout="horizontal"===a?"row":"column"});var h=parseInt(c.data("month")||(new Date).getMonth()+1),u=parseInt(c.data("year")||(new Date).getFullYear());l.calendar=new r(u,h);var y=function(a,e){"function"==typeof a&&a(e||null)};l.prev=function(){l.calendar.prev();var a={year:l.calendar.year,month:l.calendar.month+1};y(l.onPrevMonth,a)},l.next=function(){l.calendar.next();var a={year:l.calendar.year,month:l.calendar.month+1};y(l.onNextMonth,a)},l.handleDayClick=function(a){l.active=a,m.ngModel&&e(m.ngModel).assign(l.$parent,a),y(l.onDayClick,a)};var g=function(e){c.html(e),a(c.contents())(l)},f=function(){var a=n.defer();return l.templateUrl?t.get(l.template).success(a.resolve(html)).error(a.reject):a.resolve(l.template()?l.template():o),a.promise};f().then(g)}}}]);